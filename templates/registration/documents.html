{% extends 'base.html' %} 
{% block title %}Upload Dokumen{% endblock %} 
{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="mb-4">
        <h2><i class="bi bi-upload"></i> Upload Dokumen Pendaftaran</h2>
        <div class="alert alert-info">
          <strong>Nama:</strong> {{ registration.full_name }}
        </div>
      </div>

      <!-- INFO DOKUMEN WAJIB -->
      <div class="alert alert-warning mb-4">
        <h6>
          <i class="bi bi-exclamation-triangle"></i> Dokumen yang Harus Diupload
          (SEMUA WAJIB):
        </h6>
        <ol class="mb-0">
          <li><strong>KTP Siswa/Orang Tua</strong></li>
          <li><strong>Kartu Keluarga</strong></li>
          <li><strong>Akta Kelahiran</strong></li>
        </ol>
        <small class="text-muted mt-2 d-block">
          <i class="bi bi-info-circle"></i> Format file: PDF, JPG, PNG (Maksimal
          5MB per file)
        </small>
      </div>

      <!-- Upload Form -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="bi bi-cloud-upload"></i> Upload Dokumen Baru
          </h5>
        </div>
        <div class="card-body">
          {% if missing_documents %}
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i>
            <strong>Dokumen yang masih harus diupload:</strong>
            <ul class="mb-0 mt-2">
              {% for doc in missing_documents %}
              <li>{{ doc }}</li>
              {% endfor %}
            </ul>
          </div>

          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="mb-3">
              <label class="form-label"
                >Jenis Dokumen <span class="text-danger">*</span></label
              >
              {{ form.document_type }}
            </div>

            <div class="mb-3">
              <label class="form-label"
                >File Dokumen <span class="text-danger">*</span></label
              >
              {{ form.file }}
              <small class="text-muted d-block mt-1">
                Format: PDF, JPG, PNG (Maksimal 5MB)
              </small>
            </div>

            <button type="submit" class="btn btn-primary">
              <i class="bi bi-upload"></i> Upload Dokumen
            </button>
          </form>
          {% else %}
          <div class="alert alert-success">
            <i class="bi bi-check-circle"></i>
            <strong>Semua dokumen wajib sudah diupload!</strong>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Dokumen yang Sudah Diupload -->
      <div class="card shadow-sm">
          <div class="card-header bg-light">
              <h5 class="mb-0"><i class="bi bi-files"></i> Dokumen yang Sudah Diupload</h5>
          </div>
          <div class="card-body">
              {% if documents %}
                  <div class="list-group">
                      {% for doc in documents %}
                      <div class="list-group-item d-flex justify-content-between align-items-center">
                          <div>
                              <i class="bi bi-file-earmark-check text-success fs-4"></i>
                              <strong class="ms-2">{{ doc.get_document_type_display }}</strong>
                              <br>
                              <small class="text-muted ms-5">
                                  {{ doc.original_filename }} ({{ doc.file_size|filesizeformat }})
                              </small>
                          </div>
                          <div class="btn-group">
                              <a href="{{ doc.file.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                  <i class="bi bi-eye"></i> Lihat
                              </a>
                              <!-- TAMBAH TOMBOL HAPUS -->
                              <form method="post" action="{% url 'registration:delete_document' doc.id %}" 
                                    style="display: inline;" 
                                    onsubmit="return confirm('Hapus dokumen {{ doc.get_document_type_display }}? Anda perlu upload ulang.')">
                                  {% csrf_token %}
                                  <button type="submit" class="btn btn-sm btn-outline-danger">
                                      <i class="bi bi-trash"></i> Hapus
                                  </button>
                              </form>
                          </div>
                      </div>
                      {% endfor %}
                  </div>
              {% else %}
                  <p class="text-muted mb-0">Belum ada dokumen yang diupload.</p>
              {% endif %}
          </div>
      </div>

      <!-- Next Step Button -->
      <div class="card shadow-sm">
        <div class="card-body py-4">
          {% if can_proceed %}
          <div class="alert alert-success">
            <i class="bi bi-check-circle"></i>
            <strong>Semua dokumen wajib sudah lengkap!</strong>
          </div>
          <a
            href="{% url 'registration:review' registration.id %}"
            class="btn btn-success btn-lg"
          >
            <i class="bi bi-arrow-right-circle"></i> Lanjut ke Review & Submit
          </a>
          {% else %}
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i>
            <strong>Silakan upload semua dokumen wajib terlebih dahulu.</strong>
            <br />
            <small>
              Masih kurang:
              <ul class="mb-0">
                {% for doc in missing_documents %}
                <li>{{ doc }}</li>
                {% endfor %}
              </ul>
            </small>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
